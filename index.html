<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Mes EXIT</title>

  <!-- (Optionnel) manifeste & PWA si tu l'utilises déjà
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1e1e22" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Mes EXIT">
  -->

  <!-- Garde ton style.css si tu l'as déjà dans le repo -->
  <link rel="stylesheet" href="style.css" />

  <!-- Un peu de style minimal au cas où -->
  <style>
    :root{ --fg:#1e1e22; --muted:#666; --bg:#fafafa; --card:#fff; --line:#e8e8ee; --radius:14px; --shadow:0 6px 20px rgba(0,0,0,.06) }
    *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .container{max-width:920px;margin:0 auto;padding:20px}
    h1{margin:.2em 0 .1em;font-size:32px}
    .subtitle{color:var(--muted);margin:0 0 8px}
    .stats{color:var(--muted)}
    .grid{list-style:none;padding:0;margin:18px 0;display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px}
    .row{display:flex;gap:12px;align-items:flex-start;cursor:pointer}
    .doneToggle{margin-top:6px;transform:scale(1.15)}
    .content{display:grid;grid-template-columns:1fr;gap:8px}
    .title{font-weight:600}
    .meta{font-size:13px;color:var(--muted)}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);margin-right:6px}
    .cover{width:100%;height:auto;border-radius:10px;border:1px solid var(--line);background:#f6f7f9}
    .foot{padding-top:6px;padding-bottom:40px}
  </style>
</head>
<body>
  <header class="container">
    <h1>Mes EXIT</h1>
    <p class="subtitle">Liste complète (boîtes classiques) avec images. Coche ceux que tu as terminés.</p>
    <div class="stats" aria-live="polite">
      <span id="totalCount">0</span> jeux •
      <span id="doneCount">0</span> terminés •
      <span id="progressPct">0%</span> complété
    </div>
  </header>

  <main class="container">
    <ul id="gameList" class="grid" aria-live="polite" aria-busy="true"></ul>

    <template id="gameItemTpl">
      <li class="card">
        <label class="row">
          <input type="checkbox" class="doneToggle" />
          <div class="content">
            <div class="title"></div>
            <div class="meta"></div>
            <img class="cover" alt="" referrerpolicy="no-referrer" loading="lazy"/>
          </div>
        </label>
      </li>
    </template>
  </main>

  <footer class="container foot">
    <small>Les images proviennent des fiches officielles IELLO. Les coches sont stockées sur cet appareil.</small>
  </footer>

  <script>
    const STORAGE_KEYS = { DONE:'exit_done_v1' };
    let done = loadJSON(STORAGE_KEYS.DONE, {});

    // ---- LISTE COMPLÈTE (boîtes classiques uniquement) AVEC URL D'IMAGE DIRECTE ----
    const GAMES = [
      {"id":"exit-intrigue-a-venise","titre":"EXIT – Intrigue à Venise","annee":2025,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2025/02/exit-intrigue-a-venise-600x600-1.jpg"},
      {"id":"exit-course-poursuite-a-amsterdam","titre":"EXIT – Course Poursuite à Amsterdam","annee":2025,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2025/01/exit-course-poursuite-a-amsterdam-600x600-1.jpg"},
      {"id":"exit-lacademie-de-magie","titre":"EXIT – L’Académie de Magie","annee":2024,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2024/06/exit-lacademie-de-magie-600x600-1.jpg"},
      {"id":"exit-levasion-de-prison","titre":"EXIT – L’évasion de Prison","annee":2024,"difficulte":"Expert","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2024/04/exit-levasion-de-prison-600x600-1.jpg"},
      {"id":"exit-lheritage-du-voyageur","titre":"EXIT – L’héritage du Voyageur","annee":2024,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2024/02/exit-lheritage-du-voyageur-600x600-1.jpg"},
      {"id":"exit-la-disparition-de-sherlock-holmes","titre":"EXIT – La disparition de Sherlock Holmes","annee":2023,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2023/09/exit-la-disparition-de-sherlock-holmes-600x600-1.jpg"},
      {"id":"exit-le-bandit-de-fortune-city","titre":"EXIT – Le Bandit de Fortune City","annee":2023,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2023/05/exit-le-bandit-de-fortune-city-600x600-1.jpg"},
      {"id":"exit-le-retour-a-la-cabane-abandonnee","titre":"EXIT – Le Retour à la Cabane Abandonnée","annee":2023,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2023/02/exit-le-retour-a-la-cabane-abandonnee-600x600-1.jpg"},
      {"id":"exit-perils-en-terres-du-milieu","titre":"EXIT – Périls en Terres du Milieu","annee":2022,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2022/11/exit-perils-en-terres-du-milieu-600x600-1.jpg"},
      {"id":"exit-le-cimetiere-des-ombres","titre":"EXIT – Le Cimetière des Ombres","annee":2022,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2022/09/exit-le-cimetiere-des-ombres-600x600-1.jpg"},
      {"id":"exit-la-porte-entre-les-mondes","titre":"EXIT – La Porte entre les Mondes","annee":2022,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2022/06/exit-la-porte-entre-les-mondes-600x600-1.jpg"},
      {"id":"exit-le-vol-vers-linconnu","titre":"EXIT – Le Vol vers l’Inconnu","annee":2021,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2021/10/exit-le-vol-vers-linconnu-600x600-1.jpg"},
      {"id":"exit-laffaire-du-mississippi","titre":"EXIT – L’Affaire du Mississippi","annee":2021,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2021/06/exit-laffaire-du-mississippi-600x600-1.jpg"},
      {"id":"exit-la-maison-des-enigmes","titre":"EXIT – La Maison des Énigmes","annee":2020,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2020/10/exit-la-maison-des-enigmes-600x600-1.jpg"},
      {"id":"exit-le-parc-de-lhorreur","titre":"EXIT – Le Parc de l’Horreur","annee":2020,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2020/06/exit-le-parc-de-lhorreur-600x600-1.jpg"},
      {"id":"exit-les-catacombes-de-leffroi","titre":"EXIT – Les Catacombes de l’Effroi","annee":2020,"difficulte":"Expert","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2020/02/exit-les-catacombes-de-leffroi-600x600-1.jpg"},
      {"id":"exit-le-jeu-le-musee-mysterieux","titre":"EXIT : Le Jeu – Le Musée Mystérieux","annee":2019,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2019/06/exit-le-jeu-le-musee-mysterieux-600x600-1.jpg"},
      {"id":"exit-le-jeu-le-manoir-sinistre","titre":"EXIT : Le Jeu – Le Manoir Sinistre","annee":2019,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2019/02/exit-le-jeu-le-manoir-sinistre-600x600-1.jpg"},
      {"id":"exit-le-tresor-englouti","titre":"EXIT – Le Trésor Englouti","annee":2018,"difficulte":"Débutant","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2018/10/exit-le-tresor-englouti-600x600-1.jpg"},
      {"id":"exit-le-jeu-le-chateau-interdit","titre":"EXIT : Le Jeu – Le Château Interdit","annee":2018,"difficulte":"Expert","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2018/06/exit-le-jeu-le-chateau-interdit-600x600-1.jpg"},
      {"id":"exit-le-jeu-la-station-polaire","titre":"EXIT : Le Jeu – La Station Polaire","annee":2018,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2018/02/exit-le-jeu-la-station-polaire-600x600-1.jpg"},
      {"id":"exit-le-jeu-le-laboratoire-secret","titre":"EXIT : Le Jeu – Le Laboratoire Secret","annee":2017,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2017/09/exit-le-jeu-le-laboratoire-secret-600x600-1.jpg"},
      {"id":"exit-le-jeu-le-tombeau-du-pharaon","titre":"EXIT : Le Jeu – Le Tombeau du Pharaon","annee":2017,"difficulte":"Expert","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2017/09/exit-le-jeu-le-tombeau-du-pharaon-600x600-1.jpg"},
      {"id":"exit-le-jeu-la-cabane-abandonnee","titre":"EXIT : Le Jeu – La Cabane Abandonnée","annee":2017,"difficulte":"Confirmé","editeur":"IELLO","image":"https://iello.fr/wp-content/uploads/2017/09/exit-le-jeu-la-cabane-abandonnee-600x600-1.jpg"}
    ];

    // ---- Démarrage ----
    document.addEventListener('DOMContentLoaded', () => render(GAMES));

    // ---- Rendu ----
    function render(games){
      const list = document.getElementById('gameList');
      const tpl = document.getElementById('gameItemTpl');
      list.innerHTML = '';

      const visible = games.slice().sort((a,b)=>{
        const ya=a.annee??0, yb=b.annee??0;
        if (yb!==ya) return yb-ya;
        return a.titre.localeCompare(b.titre,'fr');
      });

      for (const g of visible){
        const node = tpl.content.cloneNode(true);
        const checkbox = node.querySelector('.doneToggle');
        checkbox.checked = !!done[g.id];
        checkbox.addEventListener('change', () => {
          done[g.id] = checkbox.checked || undefined;
          if (!checkbox.checked) delete done[g.id];
          saveJSON(STORAGE_KEYS.DONE, done);
          updateStats(visible.length);
        });

        node.querySelector('.title').textContent = g.titre;
        node.querySelector('.meta').innerHTML = [
          g.difficulte ? `<span class="badge">${g.difficulte}</span>` : '',
          g.annee ? `• ${g.annee}` : '',
          g.editeur ? `• ${escapeHTML(g.editeur)}` : ''
        ].filter(Boolean).join(' ');

        const img = node.querySelector('.cover');
        img.src = g.image;
        img.alt = g.titre;

        list.appendChild(node);
      }

      list.setAttribute('aria-busy','false');
      updateStats(visible.length);
    }

    function updateStats(total){
      const doneCount = Object.keys(done).length;
      const pct = total ? Math.round(doneCount/total*100) : 0;
      document.getElementById('totalCount').textContent = total;
      document.getElementById('doneCount').textContent = doneCount;
      document.getElementById('progressPct').textContent = `${pct}%`;
    }

    function loadJSON(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch{ return fallback } }
    function saveJSON(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
    function escapeHTML(s){ return s?.replace?.(/[&<>\"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) ?? s; }
  </script>
</body>
</html>